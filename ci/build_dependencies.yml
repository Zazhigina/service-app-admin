build_dep:
  stage: build dependencies
  image: gradle:7.5.1-jdk17-focal
  # when: manual
  before_script:
    - export GRADLE_USER_HOME=`pwd`/common/gradle
  script:
    - git config --global http.sslverify false
    - git clone https://gitlab-ci-token:${CI_JOB_TOKEN}@$COMMON_LIB_IMAGE
    - cd common
    - gradle --build-cache assemble -Dspring.profiles.active="$ACTIVE_PROFILE"
    - echo "$ACTIVE_PROFILE"
    - ls exception-util/build/libs
    - ls jooq-query-util/build/libs
  artifacts:
    expire_in: 1h
    name: "backend"
    paths:
      - common/exception-util/build/libs
      - common/jooq-query-util/build/libs
  only:
    refs:
      - main
